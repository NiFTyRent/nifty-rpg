<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Phaser Action RPG Source: ShowInfo.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Phaser Action RPG</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="PhaserWarp.html">PhaserWarp</a></li><li><a href="ShowInfo.html">ShowInfo</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: ShowInfo.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">import Phaser from 'phaser';

/**
 * @class
 */
export class ShowInfo {
    /**
     * This class allows one to create Dialogs with "Tiled" map editor &lt;a href="https://www.mapeditor.org/">Tiled&lt;/a>
     * Using the Objects layer https://doc.mapeditor.org/en/stable/manual/objects/ and open them
     * seemlessly with phaser.
     *
     * You should a game object to check if it overlaps your dialog information.
     *
     * Simply put, It Creates a Dialog to show messages from static objects created with "Tiled".
     * @param {Phaser.Scene} scene Scene Context.
     * @param {Phaser.GameObjects} player Player Game Object.
     * @param {Phaser.Tilemaps.Tilemap} map Tile Map to get the object from.
     */
    constructor(scene, player, map) {
        /**
         * scene Scene Context.
         * @type {Phaser.Scene}  */
        this.scene = scene;
        /**
         * player Player Game Object.
         * @type {Phaser.GameObjects}  */
        this.player = player; // Player to compare overlaps.
        /**
         * Tile Map to get the object from.
         * @type {Phaser.Tilemaps.Tilemap} */
        this.map = map;
        /**
         * Name of the object Layer in the "Tiled" software. &lt;a href="https://www.mapeditor.org/">Tiled&lt;/a>
         * Check Tiled Docs to learn more &lt;a href="https://doc.mapeditor.org/en/stable/manual/objects/">Tiled&lt;/a>
         * @type {string} */
        this.tiledObjectLayer = 'info';
        /**
         * Name of the sprite image that will be the dialog.
         *  @type {string} */
        this.dialogSpriteName = 'dialog';
        /**
         * Name of the Sprite of the button action.
         * @type {string} */
        this.actionButtonSprite = 'space';
        /**
         * Object Attribute that the you created in the Tiled Software
         * @type {string}  */
        this.messageAttribute = 'message';
        /**
         * Current action button key code.
         * @type {Phaser.Input.Keyboard.KeyCodes} */
        this.actionButtonKeyCode = Phaser.Input.Keyboard.KeyCodes.SPACE;
        /**
         * Dialog height.
         * @type {number}  */
        this.dialog_height = 150; // Dialog Height
        /**
         * Margin of the dialog. Used to make spaces in the dialog.
         * @type {number}  */
        this.margin = 15;
        /**
         * Width and Height of the corner Slice.
         * @example
         * this.nineSliceOffsets = 25;
         * // Or
         * this.nineSliceOffsets = [10, 15, 5, 5];
         * @
         * // Array Length	Use	Explanation
         * // 1	[ topRightBottomLeft ]	The first (only) element is used as the value for all four sides
         * // 2	[ topBottom, leftRight ]	The first element is used for the top and bottom, the second element is used as the for the left and right
         * // 3	[ top, rightLeft, bottom ]	The first element is used for the top, second is used for the right and left, and the third element is used for the bottom
         * // 4	[ top, right, bottom, left ]	Each element is assigned to a specific side
         * @type {number | Array&lt;number>}  */
        this.nineSliceOffsets = 23;
        this.nineSliceSafeArea = 12;
        this.actionSpriteScale = 0.5;
        this.dialogSpeed = 200;
        this.fontSize = 20;
        this.dialogMaxLines = 5;
        this.letterSpacing = 0;
        this.textWidth = this.scene.cameras.main.width - this.margin * 3; // Defines the text Width.
        this.canShowDialog = true;
        this.isOverlapingChat = false;
        this.isAnimatingText = false;
    }

    create() {
        this.dialog = this.scene.add.nineslice(
            this.margin,
            this.scene.cameras.main.height - this.dialog_height - this.margin, // this is the starting x/y location
            this.scene.cameras.main.width - this.margin * 2,
            this.dialog_height, // the width and height of your object
            this.dialogSpriteName, // a key to an already loaded image
            this.nineSliceOffsets, // the width and height to offset for a corner slice
            this.nineSliceSafeArea // (optional) pixels to offset when computing the safe usage area
        );
        this.dialog.setScrollFactor(0, 0);
        this.dialog.depth = 99;
        this.dialog.visible = false;

        this.actionButton = this.scene.add
            .image(
                this.scene.cameras.main.width - this.margin * 3,
                this.scene.cameras.main.height -
                    // this.dialog_height -
                    this.margin * 3,
                this.actionButtonSprite
            )
            .setDepth(9999)
            .setScrollFactor(0, 0)
            .setScale(this.actionSpriteScale);
        this.actionButton.visible = false;

        this.scene.tweenKey = this.scene.add.tween({
            targets: this.actionButton,
            yoyo: true,
            repeat: -1,
            scale: { from: this.actionSpriteScale, to: 0.4 },
            duration: 1000,
        });

        this.dialog.zone = this.scene.add
            .zone(
                this.margin,
                this.scene.cameras.main.height -
                    this.dialog_height -
                    this.margin, // this is the starting x/y location
                this.scene.cameras.main.width - this.margin * 2,
                this.dialog_height
            )
            .setInteractive()
            .setOrigin(0, 0);
        this.dialog.zone.setScrollFactor(0, 0);
        this.dialog.zone.depth = 999;

        this.dialog.zone.on('pointerdown', (pointer) => {
            if (this.dialog.textMessage &amp;&amp; this.dialog.textMessage.active) {
                console.log(this.dialog.textMessage.active);
                this.dialog.textMessage.destroy();
                this.dialog.visible = false;

                this.canShowDialog = true;
                console.log(this.player.body.checkCollision);
            }
        });
        // Rules to show informations!
        const infoObjects = this.map.getObjectLayer(this.tiledObjectLayer);
        let zones = [];
        infoObjects.objects.forEach((infoObj) => {
            let zone = this.scene.add.zone(
                infoObj.x,
                infoObj.y,
                infoObj.width,
                infoObj.height
            );
            this.scene.physics.add.existing(zone);
            zone.setOrigin(0, 0);
            zone.body.immovable = true;
            zones.push({ ...zone, message: infoObj.properties[0].value });
        });

        /**
         * Checks if the player is overlapping the Tiled map Zone.
         */
        this.scene.physics.add.overlap(
            zones,
            this.player,
            (zone) => {
                this.isOverlapingChat = true;
                this.actionButton.visible = true;
                this.dialogMessage = zone.message;
            },
            (d) => {
                return this.canShowDialog;
            }
        );
        this.keyObj = this.scene.input.keyboard.addKey(
            this.actionButtonKeyCode
        );

        this.scene.input.keyboard.on('keydown', (key) => {
            if (
                this.isOverlapingChat &amp;&amp;
                this.keyObj.isDown &amp;&amp;
                !this.dialog.visible
            ) {
                this.showDialog();
            } else if (this.isAnimatingText &amp;&amp; this.keyObj.isDown) {
                this.setText(this.dialogMessage, false);
            } else if (
                this.keyObj.isDown &amp;&amp;
                this.dialog.visible &amp;&amp;
                this.dialog.textMessage &amp;&amp;
                this.dialog.textMessage.active
            ) {
                this.dialog.textMessage.destroy();
                this.dialog.visible = false;
                this.canShowDialog = true;
            }
        });
    }

    /**
     * Shows the dialog with the message from the zone it's overlaping.
     * Make sure you have only one overlaping zone with the player.
     */
    showDialog() {
        this.actionButton.visible = false;
        this.dialog.visible = true;
        this.canShowDialog = false;
        const maxLettersPage =
            Math.floor(this.textWidth / this.fontSize) * this.dialogMaxLines;
        this.pageNumber = Math.ceil(this.dialogMessage.length / maxLettersPage);

        console.log('Max pages', this.pageNumber);

        this.dialog.textMessage = this.scene.add
            .text(
                this.margin * 2,
                this.scene.cameras.main.height +
                    this.margin / 2 -
                    this.dialog_height,
                '',
                {
                    wordWrap: {
                        width: this.textWidth,
                    },
                    wordWrapUseAdvanced: false,
                    fontSize: this.fontSize,
                    maxLines: this.dialogMaxLines,
                    letterSpacing: this.letterSpacing,
                    fontFamily: 'Arial, monospace',
                }
            )
            .setScrollFactor(0, 0)
            .setDepth(99999999999999999)
            .setFixedSize(
                this.scene.cameras.main.width - this.margin * 3,
                this.dialog_height
            );
        // Animates the text
        this.setText(this.dialogMessage, true);
    }

    /**
     * Sets the text for the dialog window.
     * @param { string } text The text string to be shown in the dialog.
     * @param { boolean } animate Rather it should animate the text or not. If it's false, it will stop the animation text in process.
     */
    setText(text, animate = false) {
        // Reset the dialog
        this.eventCounter = 0;
        this.animationText = text.split('');
        console.log(this.animationText);
        if (this.timedEvent) this.timedEvent.remove();

        // var tempText = animate ? '' : text;
        // this.setText(tempText);

        if (animate) {
            this.isAnimatingText = true;
            this.timedEvent = this.scene.time.addEvent({
                delay: Math.floor(1000 / this.dialogSpeed),
                callback: this.animateText,
                callbackScope: this,
                loop: true,
            });
        } else {
            if (this.timedEvent) this.timedEvent.remove();
            this.isAnimatingText = false;
            this.dialog.textMessage.text = text;
        }
    }

    /**
     * Slowly displays the text in the window to make it appear annimated
     * */
    animateText() {
        this.eventCounter++;
        this.dialog.textMessage.setText(
            this.dialog.textMessage.text +
                this.animationText[this.eventCounter - 1]
        );
        // Stops the text animation.
        if (this.eventCounter === this.animationText.length) {
            this.isAnimatingText = false;
            this.timedEvent.remove();
        }
    }

    /**
     * Checks if the player is moving.
     * @returns { boolean }
     */
    isMoving() {
        // If is colliding should always show the trigger button.
        // Pressing space button, should show the chat.
        return (
            this.player.body.velocity.x !== 0 ||
            this.player.body.velocity.y !== 0
        );
    }

    /**
     * Checks if the player is still overlaping the zone.
     * Hides the action button if it's not overlaping the zone.
     */
    checkUpdate() {
        if (
            this.actionButton &amp;&amp;
            this.isMoving() &amp;&amp;
            this.player.body.touching.none &amp;&amp;
            this.isOverlapingChat
        ) {
            this.actionButton.visible = false;
            this.isOverlapingChat = false;
        }
    }
}
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	Lorem Ipsun Studio © 2020 - todos os direitos reservados.
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a>
	
		on Wed Nov 25th 2020
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
